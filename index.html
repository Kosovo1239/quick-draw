<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Draw & Guess</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; margin: 0; }
    #canvas { border: 2px solid #333; background: white; cursor: crosshair; }
    input, button { padding: 6px; margin: 5px; }
    #chat, #wordBox, #guessInput { margin-top: 10px; }
    #message { font-weight: bold; color: green; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>🎨 Draw & Guess (Firebase Edition)</h1>
  <div>
    Room: <input id="room" placeholder="Enter room ID">
    <button onclick="joinGame()">Join</button>
    <select id="role">
      <option value="drawer">Drawer</option>
      <option value="guesser">Guesser</option>
    </select>
  </div>
  
  <div id="game" style="display:none;">
    <div id="wordBox"></div>
    <canvas id="canvas" width="500" height="400"></canvas>
    <div id="chat">
      <input id="guessInput" placeholder="Type your guess...">
      <button onclick="sendGuess()">Guess</button>
      <div id="message"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // 🔐 Replace with your Firebase project config:
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    let isDrawing = false, lastX = 0, lastY = 0;
    let role = "guesser", currentWord = "";
    let roomId = "";

    function joinGame() {
      roomId = document.getElementById("room").value.trim();
      role = document.getElementById("role").value;
      if (!roomId) return alert("Enter room ID");
      document.getElementById("game").style.display = "block";

      if (role === "drawer") {
        currentWord = randomWord();
        db.ref(`rooms/${roomId}/word`).set(currentWord);
        document.getElementById("wordBox").textContent = "Draw: " + currentWord;
      } else {
        db.ref(`rooms/${roomId}/word`).on("value", snap => {
          currentWord = snap.val();
          document.getElementById("wordBox").textContent = ""; // don't show word to guesser
        });
      }

      // Listen to drawing
      db.ref(`rooms/${roomId}/drawing`).on("child_added", snap => {
        const { x1, y1, x2, y2 } = snap.val();
        drawLine(x1, y1, x2, y2);
      });

      // Listen to guesses
      db.ref(`rooms/${roomId}/guess`).on("value", snap => {
        const guess = snap.val();
        if (role === "drawer" && guess?.toLowerCase() === currentWord?.toLowerCase()) {
          db.ref(`rooms/${roomId}/message`).set("Correct! 🎉");
        }
      });

      db.ref(`rooms/${roomId}/message`).on("value", snap => {
        document.getElementById("message").textContent = snap.val() || "";
      });
    }

    function sendGuess() {
      const guess = document.getElementById("guessInput").value;
      db.ref(`rooms/${roomId}/guess`).set(guess);
    }

    function drawLine(x1, y1, x2, y2) {
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = "black";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    canvas.addEventListener("mousedown", e => {
      if (role !== "drawer") return;
      isDrawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    canvas.addEventListener("mousemove", e => {
      if (!isDrawing || role !== "drawer") return;
      let x = e.offsetX, y = e.offsetY;
      drawLine(lastX, lastY, x, y);
      db.ref(`rooms/${roomId}/drawing`).push({ x1: lastX, y1: lastY, x2: x, y2: y });
      [lastX, lastY] = [x, y];
    });

    canvas.addEventListener("mouseup", () => isDrawing = false);
    canvas.addEventListener("mouseout", () => isDrawing = false);

    function randomWord() {
      const words = ["cat", "dog", "car", "house", "pizza", "rocket"];
      return words[Math.floor(Math.random() * words.length)];
    }
  </script>
</body>
</html>
